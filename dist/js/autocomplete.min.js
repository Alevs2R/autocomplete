!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Autocomplete=e():t.Autocomplete=e()}(this,function(){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,i){"use strict";function s(t,e){this.minHeight=e.minHeight,this.maxHeight=e.maxHeight,this.baseElement=t,this.position=e.dropdownPosition,this.displayedProperty=e.displayedProperty,this.wordEndings=e.wordEndings,this.isCreated=!1,this.isVisible=!1,this.activeElement=void 0,this.elementsList=null,this.dropdown=null,this.isLoaderShown=!1}Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n={UP:38,DOWN:40,ENTER:13,ESC:27};s.prototype={_create:function(){var t=document.createElement("div");t.className="autocomplete-dropdown",t.style.visibility="hidden",t.addEventListener("click",function(t){return t.stopPropagation()}),document.body.appendChild(t),this.dropdown=t,this.isCreated=!0},_createElement:function(t){var e=void 0;if(t.hasOwnProperty("search")&&t.search.property==this.displayedProperty){var i=t[this.displayedProperty],s=t.search,n=s.pos,o=s.length;e=i.substr(0,n)+"<b>"+i.substr(n,o)+"</b>"+i.substr(n+o)}else e=t[this.displayedProperty];var r=document.createElement("li");return r.innerHTML=e,r.addEventListener("click",this._clickEvent.bind(this)),r.listRow=t,r},_createElementsList:function(t){var e=document.createElement("ul"),i=!0,s=!1,n=void 0;try{for(var o,r=t[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var a=o.value;e.appendChild(this._createElement(a))}}catch(t){s=!0,n=t}finally{try{!i&&r.return&&r.return()}finally{if(s)throw n}}return e.addEventListener("mouseover",function(){document.body.style.overflow="hidden"}),e.addEventListener("mouseout",function(){document.body.style.overflow="auto"}),e},_createLoader:function(){var t=document.createElement("div");t.className="loader",t.innerHTML='<svg class="circle" width="16" height="16"><circle class="path" cx="8" cy="8" r="6" stroke-miterlimit="10"/></svg>';var e=document.createElement("span");return e.appendChild(document.createTextNode("Загрузка")),t.appendChild(e),t},_createEmptyMessage:function(){var t=document.createElement("div");return t.appendChild(document.createTextNode("Не найдено")),t},showLoader:function(){this.isLoaderShown||(this.clear(),this.dropdown.appendChild(this._createLoader()),this._show(),this.isLoaderShown=!0)},showError:function(){var t=this,e="Что-то пошло не так. Проверьте соединение с интернетом и попробуйте еще раз",i="Обновить";this.clear();var s=document.createElement("div");s.appendChild(document.createTextNode(e));var n=document.createElement("div");n.className="autocomplete-control",n.appendChild(document.createTextNode(i)),n.addEventListener("click",function(){return t.reload()}),this.onEnterClick=function(){return t.reload()},this.dropdown.appendChild(s),this.dropdown.appendChild(n),this._show()},showList:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.clear(),0==t.length)this.dropdown.appendChild(this._createEmptyMessage());else{if(null==i||t.length<=i){var s=this._createElementsList(t);this.dropdown.appendChild(s),this.setActiveElement(s.firstChild)}else{var n=this._createElementsList(t.slice(0,i));this.dropdown.appendChild(n),this.setActiveElement(n.firstChild),this.dropdown.appendChild(this._getSummary(i,t.length))}this.onEnterClick=function(){return e.select(e.activeElement.listRow)}}this._show()},_getSummary:function(t,e){var i=document.createElement("div"),s=e%100!=11&&e%10==1?"найденного "+this.wordEndings[0]:"найденных "+this.wordEndings[1],n="Показано "+t+" из "+e+" "+s+". Уточните запрос, чтобы увидеть остальные";return i.appendChild(document.createTextNode(n)),i.className="autocomplete-summary",i},_clickEvent:function(t){this.select(t.target.listRow)},_getHeight:function(t){return Math.min(Math.max(this.minHeight,t),this.maxHeight)},_getCoords:function(t){var e=t.getBoundingClientRect(),i=document.body,s=document.documentElement,n=window.pageYOffset||s.scrollTop||i.scrollTop,o=window.pageXOffset||s.scrollLeft||i.scrollLeft,r=s.clientTop||i.clientTop||0,a=s.clientLeft||i.clientLeft||0,h=e.top+n-r,d=e.left+o-a;return{top:Math.round(h),bottom:Math.round(h)+t.offsetHeight,left:Math.round(d)}},_updateWidth:function(){var t=30,e=this.dropdown.coordLeft,i=document.body.clientWidth-e,s=Math.min(this.baseElement.offsetWidth+t,i),n=void 0,o=this.dropdown.getElementsByTagName("ul");o.length>0?(this.dropdown.style.width="auto",n=Math.min(Math.max(s,o[0].offsetWidth+1),i),o[0].style.width="100%",o[0].style.display="block"):n=s,this.dropdown.style.width=n+"px"},_setListHeight:function(t){var e=this.dropdown.getElementsByTagName("ul");e.length>0&&(this.dropdown.getElementsByTagName("div").length>0?e[0].style.maxHeight=t-42+"px":e[0].style.maxHeight=t+"px")},_show:function(){if(this.isCreated){var t=2,e=this._getCoords(this.baseElement),i=document.body.clientHeight-e.bottom;"top"==this.position||"auto"==this.position&&i<this.minHeight?(this._setListHeight(this._getHeight(e.top-t)),this.dropdown.style.bottom=document.body.clientHeight-e.top+t+"px"):(this.dropdown.style.top=e.top+this.baseElement.offsetHeight+t+"px",this._setListHeight(this._getHeight(i-t))),this.dropdown.coordLeft=e.left,this.dropdown.style.left=e.left+"px",this._updateWidth(),this.dropdown.style.visibility="visible",this.isVisible=!0}},setActiveElement:function(t){this.activeElement&&(this.activeElement.className=""),t.className="active",this.activeElement=t;var e=t.offsetTop,i=e+30,s=this.dropdown.getElementsByTagName("ul")[0];s.scrollTop+s.clientHeight<i?s.scrollTop=i-s.clientHeight:e<s.scrollTop&&(s.scrollTop=e)},_resetVars:function(){this.isCreated=!1,this.isVisible=!1,this.activeElement=null,this.isLoaderShown=!1},remove:function(){this.isCreated&&(this._resetVars(),this.dropdown.parentNode.removeChild(this.dropdown),document.body.style.overflow="auto")},clear:function(){this.isLoaderShown=!1,this.activeElement=null,this.isCreated?this.dropdown.innerHTML="":this._create()},select:function(){},keyDownEvent:function(t){var e=!0;switch(t.keyCode){case n.DOWN:if(!this.activeElement||!this.activeElement.nextSibling)return;this.setActiveElement(this.activeElement.nextSibling);break;case n.UP:if(!this.activeElement||!this.activeElement.previousSibling)return;this.setActiveElement(this.activeElement.previousSibling);break;case n.ENTER:this.onEnterClick&&this.onEnterClick();break;case n.ESC:this.remove();break;default:e=!1}e&&t.preventDefault()}}},function(t,e){},function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function n(t,e){var i={};Object.assign(i,t);for(var s in e)i[s]=e[s];return i}function o(t,e){return new r(t,e)}function r(t,e){this.options=n(d,e);try{this.setInput(t),this.setData(this.options.source)}catch(t){return void window.console.error(t)}this.dropdown=new h.default(this.input,this.options),this.dropdown.select=this._selectElement.bind(this),this.dropdown.reload=function(){this._search(this.input.value)}.bind(this),this._bindInputEvents(),this.handleEvent=function(t){switch(t.type){case"focus":this._onFocusEvent();break;case"input":this._search(this.input.value);break;case"keydown":this._keyDownEvent(t)}},this._onClickOutside=this._onClickOutside.bind(this),this.lastSearch=null,this.selected=void 0,this.sourceIsDynamic=!1}var a=i(0),h=s(a);i(1),t.exports=o;var d={source:null,arrow:!1,maxResults:5,minHeight:200,maxHeight:450,displayedProperty:"value",dropdownPosition:"auto",sort:!1,sortBy:null,sortOrder:"asc",isValidElement:function(){return!0},searchByEntry:!1,caseSensitive:!1,wordEndings:null,ownValue:!1};r.prototype={messages:{error:"Выберите значение из списка",warning:"Значения нет в справочнике. <br> Возможно, вы ошиблись в написании"},setData:function(t){if("string"==typeof t)this.source=t;else if("function"==typeof t)this.source=t,this.sourceIsDynamic=!0;else{if(!(t instanceof Array))throw"source should be instance of Array or String";var e=void 0;"string"==typeof t[0]?(e=t.map(function(t){}),this.options.displayedProperty="value"):e=t,this.data=this.sort(e)}},sort:function(t){if(this.options.sort){var e=this.options.sortBy?this.options.sortBy:this.options.displayedProperty,i="asc"==this.options.sortOrder?-1:1;return t.sort(function(t,s){return t[e]<s[e]?i:t[e]>s[e]?-i:0})}},setInput:function(t){if("string"==typeof t)this.input=document.querySelector(t);else{if(!t.hasOwnProperty("tagName")||"input"!=t.tagName)throw"1 argument should be String or instance of Element with tagName input";this.input=t}},_selectElement:function(t){this.input.value=t[this.options.displayedProperty],this.selected=t,this._finishTyping(),this.onselect(t)},onselect:function(){},_bindInputEvents:function(){this.input.addEventListener("input",this,!1),this.input.addEventListener("focus",this,!1)},_keyDownEvent:function(t){this.dropdown.isVisible&&this.dropdown.keyDownEvent(t),9!=t.keyCode&&13!=t.keyCode||(this._finishTyping(),this._focusToNextControl())},_makeRequest:function(t){return new Promise(function(e,i){this.xhr&&this.xhr.abort();var s=new XMLHttpRequest;s.open("GET",t),s.onload=function(){this.status>=200&&this.status<300?e(JSON.parse(s.responseText)):i({status:this.status,statusText:s.statusText})},s.onerror=function(){i({status:this.status,statusText:s.statusText})},s.send(),this.xhr=s}.bind(this))},_abortRequest:function(){this.xhr&&this.xhr.abort(),this.dataRequestFinished=!0},_loadData:function(t){var e=this;return new Promise(function(i,s){var n=void 0;e.dataRequestFinished=!1,e._makeRequest(t).then(function(t){n=function(){return i(t)}}).catch(function(t){n=function(){return s(t)}}).then(function(){e.dataRequestFinished=!0,e.dropdown.isLoaderShown||n()}),setTimeout(function(){if(!e.dataRequestFinished){e.dropdown.showLoader();var t=setInterval(function(){e.dataRequestFinished&&(clearInterval(t),n&&n())},1e3)}},500)})},testByEntry:function(t,e){return t=" "+t.replace(/"/g,""),t.indexOf(" "+e)},_getSearchResult:function(t){if(this.lastSearch&&t.startsWith(this.lastSearch.value)?this.lastSearch.result:this.data,!this.data)return[];var e=this.options.caseSensitive?t:t.toLowerCase(),i=[],s=!0,n=!1,o=void 0;try{for(var r,a=this.data[Symbol.iterator]();!(s=(r=a.next()).done);s=!0){var h=r.value;if(this.options.isValidElement(h)){h[this.options.displayedProperty]==t&&(this.selected=h);for(var d in h)if(h.hasOwnProperty(d)){var l=this.options.caseSensitive?String(h[d]):String(h[d]).toLowerCase();if(this.options.searchByEntry){var c=this.testByEntry(l,e);if(c!=-1){h.search={pos:c,property:d,length:e.length},i.push(h);break}}else if(l.startsWith(e)){i.push(h);break}}}}}catch(t){n=!0,o=t}finally{try{!s&&a.return&&a.return()}finally{if(n)throw o}}return this.lastSearch={value:t,result:i},i},_search:function(t){var e=this;this.selected=null,t?this.sourceIsDynamic?this._loadData(this.source(t)).then(function(t){return e.dropdown.showList(e.sort(t),e.options.maxResults)}).catch(function(t){return e.dropdown.showError()}):this.data?this.dropdown.showList(this._getSearchResult(t.trim()),this.options.maxResults):this._loadData(this.source).then(function(i){e.data=e.sort(i),e.dropdown.showList(e._getSearchResult(t.trim()),e.options.maxResults)},this.options.maxResults).catch(function(t){return e.dropdown.showError()}):this.dropdown.remove()},_validate:function(){this.selected?this.input.classList.add("fulfilled"):this.options.ownValue?(this.input.classList.add("warning"),this._showUnderInput(this.messages.warning,"warning")):(this.input.classList.add("error"),this._showUnderInput(this.messages.error,"error"))},_onFocusEvent:function(){document.body.addEventListener("click",this._onClickOutside),this.input.className="autocomplete",this.messageUnderInput&&(this.input.parentNode.removeChild(this.messageUnderInput),this.messageUnderInput=null),this.input.select(),this.lastSearch=null,document.addEventListener("keydown",this)},_onClickOutside:function(t){t.target!=this.input&&this._finishTyping()},_finishTyping:function(){if(this.dataRequestFinished||this._abortRequest(),!this.selected&&this.lastSearch&&1==this.lastSearch.result.length){var t=this.lastSearch.result[0];this._selectElement(t)}this.dropdown.remove(),this._validate(),document.body.removeEventListener("click",this._onClickOutside),document.removeEventListener("keydown",this),this.input.removeEventListener("click",this)},_showUnderInput:function(t,e){var i=document.createElement("div");i.classList.add("autocomplete-message"),i.classList.add(e),i.innerHTML=t,i.style.top=this.input.offsetHeight,this.input.parentNode.appendChild(i),this.messageUnderInput=i},_focusToNextControl:function(){this.input.blur();var t=document.querySelector('[tabIndex="'+(+this.input.tabIndex+1)+'"]');if(!t){var e=Array.prototype.slice.call(document.getElementsByTagName("input"));t=e[e.indexOf(this.input)+1]}t&&t.focus()}}}])});
//# sourceMappingURL=autocomplete.min.js.map